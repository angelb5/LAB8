<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Juegos</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    </head>
    <body>
        <div class="container">
            <div>
                <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #eaedfc;">
                    <div class="container-fluid">
                    <a class="navbar-brand" href="juegos.html">
                        <img src="img/icon.png" width="30" height="30" class="d-inline-block align-top" alt="" loading="lazy">
                        GameShop4 <span style="color: black;">[Lab 8]</span>
                    </a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav">

                                <li class="nav-item">
                                    <a class="nav-link active" href="juegos.html">Juegos</a>
                                </li>

                                <li class="nav-item">
                                    <a class="nav-link" href="plataformas.html">Plataformas</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="distribuidoras.html">Distribuidoras</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
        <div class="container py-4" style="width: 50%;">
            <h2 class="page-header text-center" >Juego</h2>
            <form autocomplete="off">
                <div class="mb-3">
                    <label class="form-label">Nombre: </label>
                    <input id="nombre" class="form-control" name="nombre" >
                    <div id="nombreFeedback"></div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Descripción: </label>
                    <textarea class="form-control"  id="descripcion" name="descripcion"></textarea>
                    <div id="descripcionFeedback"></div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Género</label>
                    <select class="form-select" id="genero" name="genero">
                        <option style="color: #333333;" value="">- Seleccionar genero -</option>
                        <option value="Acción">Acción</option>
                        <option value="Aventura">Aventura</option>
                        <option value="Estrategia">Estrategia</option>
                        <option value="Simulación">Simulación</option>
                        <option value="Plataformas">Plataformas</option>
                        <option value="RPG">RPG</option>
                        <option value="Party">Party</option>
                    </select>
                    <div id="generoFeedback"></div>
                </div>
                <div class=" mb-3">
                    <label class="form-label">Plataforma</label>
                    <select class="form-select" id="plataforma" name="plataforma">
                        <option style="color: #333333;" value="">- Seleccionar plataforma -</option>
                        <option value="XBOX One" >XBOX One</option>
                        <option value="XBOX Series X">XBOX Series X</option>
                        <option value="PlayStation 4">PlayStation 4</option>
                        <option value="PlayStation 5">PlayStation 5</option>
                        <option value="Nintendo Switch">Nintendo Switch</option>
                        <option value="Nintendo Wii">Nintendo Wii</option>
                        <option value="PSP">PSP</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Distribuidora</label>
                    <select class="form-select" id="distribuidora" name="distribuidora">
                        <option style="color: #333333;" value="">- Seleccionar distribuidora -</option>
                        <option value="Nintendo">Nintendo</option>
                        <option value="PlayStation">PlayStation</option>
                        <option value="XBOX">XBOX</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Imagen URL: </label>
                    <input class="form-control" id="urlImage" name="urlImage" type="url">
                    <div id="urlImageFeedback"></div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Precio: </label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">S/.</span>
                        </div>
                        <input class="form-control" name="precio" id="precio" type="text" class="form-control" aria-label="Ingrese monto.">
                        <div id="precioFeedback"></div>
                    </div>
                </div>

                <div class="mb-3">
                        <a class="btn btn-danger" href="juegos.html">Cancelar</a>
                        <button type="submit" class="btn btn-primary">Añadir</button>
                    
                </div>
            </form>
        </div>
        <div class="container py-4">
            <div class="page-header text-center">
                <h2>Lista de Juegos</h2>
            </div>
            <div class="alert alert-warning alert-dismissible fade show" role="alert" id="creacionExitosa" style="display: none;">
                Juego creado exitosamente!
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <table class="table table-striped">
                <thead>
                <tr>
                    <th>#</th>
                    <th class="col-2"></th>
                    <th style="width: 18%">Nombre</th>
                    <th style="width: 32%">Descripción</th>
                    <th style="width: 10%">Plataforma</th>
                    <th style="width: 10%">Distribuidora</th>
                    <th style="width: 30%">Precio (S/)</th>
                    <th style="width: 8%"></th>
                    <th style="width: 8%"></th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>1</td>
                    <td>
                        <img src="https://media.vandal.net/m/96931/leyendas-pokemon-arceus-202152616392725_1.jpg" class="w-100" alt="Leyendas Pokémon: Arceus">
                    </td>
                    <td>
                        <span>Leyendas Pokémon: Arceus</span>
                        <span class="mx-2 badge bg-warning text-black">RPG</span>
                    </td>
                    <td>Este videojuego de rol, que se desarrollará en Sinnoh, nos llevará a una época pasada de inspiración feudal, apostando por el mundo abierto tridimensional e incorporando nuevas mecánicas de captura y combate que buscan renovar para siempre la saga de cara al futuro.</td>
                    <td>Nintendo Switch</td>
                    <td>Nintendo</td>
                    <td>160.0</td>
                    <td>
                        <a class="btn btn-primary" title="Editar" href="#"><span class="bi bi-pencil-square"></span></a>
                    </td>
                    <td>
                        <a class="btn btn-danger" title="Borrar" href="#"><span class="bi bi-trash"></span></a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="container">
            <footer class="py-4 bg-light mt-auto">
                <div class="container-fluid">
                    <div class="d-flex align-items-center justify-content-between small">
                        <div class="text-muted">
                            <span>Grupo 4 - PUCP @  2022</span>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
        

        <div class="modal" id="modalError" tabindex="-1">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Error!</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="feedback"></p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ok :(</button>
                </div>
              </div>
            </div>
        </div>

        <script type="text/javascript">
            var idreg = 1;
            var id=idreg;
            var editando = false;
            var juegos=[];

            // Validación nombre
            $("#nombre").keyup(function(){
                let nombre = $(this).val();
                let nFeedback = $("#nombreFeedback");
                $("#nombreFeedback").show();
                if(nombre.length<3){
                    $(this).attr("class", "form-control is-invalid");
                    nFeedback.attr("class", "invalid-feedback");
                    nFeedback.html("El nombre no puede ser menor a 3 caracteres.");
                }else if(nombre.length>50){
                    $(this).attr("class", "form-control is-invalid");
                    nFeedback.attr("class", "invalid-feedback");
                    nFeedback.html("El nombre no puede ser mayor a 50 caracteres.");
                }else{
                    $(this).attr("class", "form-control is-valid");
                    nFeedback.attr("class", "valid-feedback");
                    nFeedback.html("Verificado.");
                }
            })
            // Validación descripción
            $("#descripcion").keyup(function(){
                let descripcion = $(this).val();
                let nFeedback = $("#descripcionFeedback");
                $("#descripcionFeedback").show();
                if(descripcion.length<3){
                    $(this).attr("class", "form-control is-invalid");
                    nFeedback.attr("class", "invalid-feedback");
                    nFeedback.html("La descripcion no puede ser menor a 3 caracteres.");
                }else if(descripcion.length>250){
                    $(this).attr("class", "form-control is-invalid");
                    nFeedback.attr("class", "invalid-feedback");
                    nFeedback.html("La descripcion no puede ser mayor a 250 caracteres.");
                }else{
                    $(this).attr("class", "form-control is-valid");
                    nFeedback.attr("class", "valid-feedback");
                    nFeedback.html("Verificado.");
                }
            })
            // Validación url
            $("#urlImage").keyup(function(){
                let urlImage = $(this).val();
                let urlValida = /^(ftp|http|https):\/\/[^ "]+$/.test(urlImage);
                let nFeedback = $("#urlImageFeedback");
                $("#urlImageFeedback").show();
                if(urlImage.length<3){
                    $(this).attr("class", "form-control is-invalid");
                    nFeedback.attr("class", "invalid-feedback");
                    nFeedback.html("La URL no puede ser menor a 3 caracteres.");
                }else if(urlImage.length>198){
                    $(this).attr("class", "form-control is-invalid");
                    nFeedback.attr("class", "invalid-feedback");
                    nFeedback.html("La URL no puede ser mayor a 198 caracteres.");
                }else if(!urlValida) {
                    $(this).attr("class", "form-control is-invalid");
                    nFeedback.attr("class", "invalid-feedback");
                    nFeedback.html("Debe ingresar una URL.");
                }else {
                        $(this).attr("class", "form-control is-valid");
                        nFeedback.attr("class", "valid-feedback");
                        nFeedback.html("URL verificada.");
                }
            })

            // Validación precio
            $("#precio").keyup(function() {
                let precio = $(this).val();
                let nFeedback = $("#precioFeedback");
                $("#precioFeedback").show();
                if (precio < 50) {
                    $(this).attr("class", "form-control is-invalid");
                    nFeedback.attr("class", "invalid-feedback");
                    nFeedback.html("El precio debe ser mayor a S/. 50.00");
                } else if (precio > 550) {
                    $(this).attr("class", "form-control is-invalid");
                    nFeedback.attr("class", "invalid-feedback");
                    nFeedback.html("El precio debe ser menor a S/. 550.00");
                }else if (isNaN(precio)){
                    $(this).attr("class", "form-control is-invalid");
                    nFeedback.attr("class", "invalid-feedback");
                    nFeedback.html("Debe ingresar un número.");
                }else{
                    $(this).attr("class", "form-control is-valid");
                    nFeedback.attr("class", "valid-feedback");
                    nFeedback.html("Verificado.");
                }
            })
            // Validación genero
            $("#genero").keyup(function(){
                let genero = $(this).val();
                let nFeedback = $("#generoFeedback");
                $("#generoFeedback").show();
                if(genero === ""){
                    $(this).attr("class", "form-control is-invalid");
                    nFeedback.attr("class", "invalid-feedback");
                    nFeedback.html("Debe seleccionar un género.");
                } else{
                    $(this).attr("class", "form-control is-valid");
                    nFeedback.attr("class", "valid-feedback");
                    nFeedback.html("Verificado.");
                }
            })


            $(document).ready(function() {
                $("#nombreFeedback").hide();
                $("form").submit(function(event){
                    event.preventDefault();
                    let nombre = $("#nombre").val();
                    let descripcion = $("#descripcion").val();
                    let genero = $('#genero option:selected').val();
                    let plataforma = $('#plataforma option:selected').val();
                    let distribuidora = $('#distribuidora option:selected').val();
                    let urlimage = $("#urlImage").val();
                    let precio = $("#precio").val();
                    
                    if(nombre!="" && genero!="" && plataforma !="" && distribuidora!="" && urlImage != "" && precio!=""){
                        if(nombre.length>=3 && nombre.length<=50 && descripcion.length>=3 && descripcion.length<=250 && urlimage.length>=10 && urlimage.length<=256 && !isNaN(precio) && precio>=50 && precio<=550 ){
                            if(editando){
                                $("#"+id).remove();
                            }
                            let juego ={
                                id: id,
                                nombre: nombre,
                                descripcion: descripcion,
                                genero: genero,
                                plataforma: plataforma,
                                distribuidora: distribuidora,
                                urlimage: urlimage,
                                precio: precio
                            }
                            //Juego creado exitosamente
                            $("#creacionExitosa").show(500).delay(3000).hide(500);
                            appendtable(juego);
                            juegos.push(juego);

                            if(!editando){
                                idreg++; 
                                id=idreg;
                            }else{
                                id=idreg;
                                editando=false;
                            }
                            $('form').trigger("reset");
                            $("input").attr("class", "form-control")
                            $(".valid-feedback").hide();
                        }else{
                            $("#modalError").modal('show');
                            $("#feedback").html("Los datos no son correctos");
                        }
                    }else{
                        $("#modalError").modal('show');
                        $("#feedback").html("No se ingresaron todos los datos");
                    }

                });
            });
           function borrar(idb){
                $("#"+idb).remove();
                id=idreg;
           }
           function editar(ide){
                editando=true;
                id=ide;
                let juegoEditar = juegos.find( e => e.id==ide);
                $("#nombre").val(juegoEditar.nombre);
                $("#descripcion").val(juegoEditar.descripcion);
                $("#genero option:selected").val(juegoEditar.genero);
                $("#distribuidora option:selected").val(juegoEditar.distribuidora);
                $("#plataforma option:selected").val(juegoEditar.plataforma);
                $("#urlImage").val(juegoEditar.urlimage);
                $("#precio").val(juegoEditar.precio);
           }
           function appendtable(juego){
            $('table').append('<tr id="'+juego.id+'">'+
                                '<td>'+juego.id+'</td>'+
                                '<td><img src="'+juego.urlimage+'" class="w-100"></td>'+
                                '<td><span>'+juego.nombre+'</span><span class="mx-2 badge bg-warning text-black">'+juego.genero+'</span></td>'+
                                '<td>'+juego.descripcion+'</td>'+
                                '<td>'+juego.plataforma+'</td>'+
                                '<td>'+juego.distribuidora+'</td>'+
                                '<td>'+(Math.round(juego.precio * 100) / 100).toFixed(2)+ '</td>'+
                                '<td><a class="btn btn-primary" title="Editar" onclick="editar('+juego.id+')"><span class="bi bi-pencil-square"></span></a></td>'+
                                '<td><a class="btn btn-danger" title="Borrar" onclick="borrar('+juego.id+')"><span class="bi bi-trash"></span></a></td>');
                            
           }
        </script>
    </body>
</html>